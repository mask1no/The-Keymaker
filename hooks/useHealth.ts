'use client';
import useSWR from 'swr'; type HealthStatus = 'healthy' | 'degraded' | 'down'; export interface HealthResponse { ok: boolean; version: string; timestamp: string; checks: { rpc: { status: HealthStatus; latency_ms: number; endpoint?: string; last_check?: string }; jito: { status: HealthStatus; latency_ms: number; region?: string; endpoint?: string; last_check?: string; }; database?: { status: HealthStatus }; puppeteer?: { status: HealthStatus }; }; duration_ms?: number;
} async function fetcher(url: string): Promise<HealthResponse> { const res = await fetch(url, { cache: 'no-store' }); if (!res.ok) throw new Error('Failed to fetch health'); return res.json();
} export function useHealth() { const { data, error, isLoading, mutate } = useSWR<HealthResponse>('/api/health', fetcher, { refreshInterval: 10000, revalidateOnFocus: false }); return { health: data, healthy: !!data?.ok, rpcHealthy: data?.checks.rpc.status === 'healthy', jitoHealthy: data?.checks.jito.status === 'healthy', loading: isLoading, error, refresh: mutate };
}
