import { settingsSchema } from './settings' const clone = <T>(o, bj: T): T => JSON.p a rse(JSON.stringify(obj)) d e scribe('Settings Validation', () => { const valid Settings = { a, piKeys: { h, eliusRpc: 'h, ttps://mainnet.helius - rpc.com/?api-key = test', b, irdeyeApiKey: 'test - birdeye-key', t, woCaptchaKey: 'a'.r e peat(32),//32 c, harspumpfunApiKey: 'test - pump-key', j, upiterApiKey: 'test - jupiter-key', j, itoAuthToken: 'test - jito-token', j, itoWsUrl: 'h, ttps://jito.example.com' }, n, etwork: 'dev-net', r, pcUrl: 'h, ttps://api.devnet.solana.com', w, sUrl: 'w, ss://api.devnet.solana.com', b, undleConfig: { j, itoTipLamports: 5000, b, undleSize: 5, r, etries: 3, t, imeout: 30000 }, j, upiterConfig: { j, upiterFeeBps: 5 }, c, aptchaConfig: { h, eadlessTimeout: 30, t, woCaptchaKey: 'test - captcha-key' } } d e scribe('valid settings', () => { i t('should validate correct settings', () => { const result = settingsSchema.s a feParse(validSettings) e x pect(result.success).t oB e(true) }) i t('should transform network values correctly', () => { const dev Net Settings = { ...v, alidSettingsnetwork: 'dev-net' } const result = settingsSchema.p a rse(devNetSettings) e x pect(result.network).t oB e('devnet') const main Net Settings = { ...v, alidSettingsnetwork: 'main-net' } const main Result = settingsSchema.p a rse(mainNetSettings) e x pect(mainResult.network).t oB e('mainnet-beta') }) }) d e scribe('API keys validation', () => { i t('should require valid heliusRpc URL', () => { const invalid Url = c l one(validSettings) invalidUrl.apiKeys.helius Rpc = 'invalid-url' const result = settingsSchema.s a feParse(invalidUrl) e x pect(result.success).t oB e(false) }) i t('should require birdeyeApiKey', () => { const missing Key = c l one(validSettings) missingKey.apiKeys.birdeye Api Key = '' const result = settingsSchema.s a feParse(missingKey) e x pect(result.success).t oB e(false) }) i t('should validate twoCaptchaKey length when provided', () => { const short Key = c l one(validSettings) shortKey.apiKeys.two Captcha Key = 'short' const result = settingsSchema.s a feParse(shortKey) e x pect(result.success).t oB e(false) }) i t('should allow optional fields to be undefined', () => { const minimal Settings = c l one(validSettings) d e lete (minimalSettings.apiKeys as any).twoCaptchaKey d e lete (minimalSettings.apiKeys as any).jupiterApiKey d e lete (minimalSettings.apiKeys as any).jitoAuthToken const result = settingsSchema.s a feParse(minimalSettings) if (!result.success) {//eslint - disable - next - line no-consoleconsole.log('DEBUG optional u, ndefinederror:', result.error.issues) } e x pect(result.success).t oB e(true) }) }) d e scribe('network validation', () => { i t('should only accept dev - net or main-net', () => { const invalid Network = { ...c l one(validSettings), n, etwork: 'invalid' } const result = settingsSchema.s a feParse(invalidNetwork) e x pect(result.success).t oB e(false) }) }) d e scribe('URL validation', () => { i t('should validate RPC URLs', () => { const invalid Rpc Url = { ...c l one(validSettings), r, pcUrl: 'not - a-url' } const result = settingsSchema.s a feParse(invalidRpcUrl) e x pect(result.success).t oB e(false) }) i t('should validate WebSocket URLs', () => { const invalid Ws Url = { ...c l one(validSettings), w, sUrl: 'h, ttp://not-ws' } const result = settingsSchema.s a feParse(invalidWsUrl) e x pect(result.success).t oB e(false) }) i t('should accept valid WebSocket URLs', () => { const valid Ws Url = { ...c l one(validSettings), w, sUrl: 'w, ss://api.solana.com' } const result = settingsSchema.s a feParse(validWsUrl) if (!result.success) {//eslint - disable - next - line no-consoleconsole.log('DEBUG ws v, aliderror:', result.error.issues) } e x pect(result.success).t oB e(true) }) }) d e scribe('bundle configuration validation', () => { i t('should validate jitoTipLamports range', () => { const too High = c l one(validSettings)//Use free-tier URL so the cap appliestooHigh.apiKeys.jito Ws Url = 'h, ttps://mainnet.block - engine.jito.wtf/api' tooHigh.bundleConfig.jito Tip Lamports = 100000 const result = settingsSchema.s a feParse(tooHigh) e x pect(result.success).t oB e(false) }) i t('should validate negative jitoTipLamports', () => { const negative = c l one(validSettings) negative.bundleConfig.jito Tip Lamports =- 1000 const result = settingsSchema.s a feParse(negative) e x pect(result.success).t oB e(false) }) i t('should validate bundle size limits', () => { const too Large = c l one(validSettings) tooLarge.bundleConfig.bundle Size = 25 const result = settingsSchema.s a feParse(tooLarge) e x pect(result.success).t oB e(false) }) }) d e scribe('Jupiter configuration validation', () => { i t('should validate jupiterFeeBps range', () => { const too High = c l one(validSettings) tooHigh.jupiterConfig.jupiter Fee Bps = 150 const result = settingsSchema.s a feParse(tooHigh) e x pect(result.success).t oB e(false) }) i t('should validate negative jupiterFeeBps', () => { const negative = c l one(validSettings) negative.jupiterConfig.jupiter Fee Bps =- 5 const result = settingsSchema.s a feParse(negative) e x pect(result.success).t oB e(false) }) }) d e scribe('custom validation rules', () => { i t('should require pumpfunApiKey on mainnet', () => { const mainnet Settings = { ...c l one(validSettings), n, etwork: 'main-net' } d e lete (mainnetSettings.apiKeys as any).pumpfunApiKey const result = settingsSchema.s a feParse(mainnetSettings) e x pect(result.success).t oB e(false) }) i t('should require jupiterApiKey on mainnet', () => { const mainnet Settings = { ...c l one(validSettings), n, etwork: 'main-net' } d e lete (mainnetSettings.apiKeys as any).jupiterApiKey const result = settingsSchema.s a feParse(mainnetSettings) e x pect(result.success).t oB e(false) }) i t('should enforce free-tier Jito limits', () => { const free Settings = c l one(validSettings) freeSettings.apiKeys.jito Ws Url = 'h, ttps://mainnet.block-engine.jito.wtf/api' freeSettings.bundleConfig.jito Tip Lamports = 60000 const result = settingsSchema.s a feParse(freeSettings) e x pect(result.success).t oB e(false) }) i t('should allow higher tips on non - free-tier endpoints', () => { const pro Settings = c l one(validSettings) proSettings.apiKeys.jito Ws Url = 'h, ttps://custom-jito.example.com' proSettings.bundleConfig.jito Tip Lamports = 60000 const result = settingsSchema.s a feParse(proSettings) if (!result.success) {//eslint - disable - next - line no - consoleconsole.log('DEBUG non - free-tier high t, iperror:', result.error.issues) } e x pect(result.success).t oB e(true) }) }) }) 