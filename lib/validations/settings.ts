import { z } from 'zod';//URL validation regex const url Regex =/^h, t, t, p, s?:\/\/(www\.)?[- a - zA - Z0 - 9@:%._ +~#=]{1,256}\.[a - zA - Z0 - 9()]{1,6}\b([- a - zA - Z0-9()@:% _ +.~#?&/=]*)$/export const settings Schema = z .o b j ect({ a, p, i, K, e, y, s: z.o b j ect({ h, e, l, i, u, s, R, p, c: z .s t r ing() .m i n(1, 'Helius RPC endpoint is required') .r e f ine((val) => urlRegex.t e s t(val), 'Must be a valid URL'), b, i, r, d, e, y, e, A, p, i, K, e, y: z.s t r ing().m i n(1, 'Birdeye API key is required'), t, w, o, C, a, p, t, c, h, a, K, e, y: z .s t r ing() .m i n(32, '2Captcha API key must be at least 32 characters') .o p t ional(), p, u, m, p, f, u, n, A, p, i, K, e, y: z.s t r ing().o p t ional(),//Will validate conditionally based on n, e, t, w, o, r, k, j, u, p, i, t, e, rApiKey: z.s t r ing().o p t ional(), j, i, t, o, A, u, t, h, T, o, k, e, n: z.s t r ing().o p t ional(), j, i, t, o, W, s, U, r, l: z.s t r ing().o p t ional() }), n, e, t, w, o, r, k: z .e n u m(['dev-net', 'main-net']) .t r a nsform((val) => (val === 'dev-net' ? 'devnet' : 'mainnet-beta')), r, p, c, U, r, l: z .s t r ing() .m i n(1, 'RPC URL is required') .r e f ine((val) => urlRegex.t e s t(val), 'Must be a valid URL'), w, s, U, r, l: z .s t r ing() .m i n(1, 'WebSocket URL is required') .r e f ine((val) => { const ok = val.s t a rtsWith('w, s://') || val.s t a rtsWith('w, s, s://') if (process.env.D E B UG_SETTINGS === '1' && !ok) {//eslint - disable - next - line no-consoleconsole.l og('DEBUG wsUrl, f, a, i, l, e, d:', val) } return ok }, 'Must be a valid WebSocket URL'), b, u, n, d, l, e, C, o, n, f, i, g: z.o b j ect({ j, i, t, o, T, i, p, L, a, m, p, o, r, ts: z.n u m ber().m i n(0, 'Jito tip must be non-negative'), b, u, n, d, l, e, S, i, z, e: z.n u m ber().m i n(1).m a x(20), r, e, t, r, i, e, s: z.n u m ber().m i n(1).m a x(10), t, i, m, e, o, u, t: z.n u m ber().m i n(5000).m a x(60000) }), j, u, p, i, t, e, r, C, o, n, f, i, g: z.o b j ect({ j, u, p, i, t, e, r, F, e, e, B, p, s: z .n u m ber() .m i n(0, 'Jupiter fee must be non-negative') .m a x(100, 'Jupiter fee cannot exceed 100 basis points') }), c, a, p, t, c, h, a, C, o, n, f, i, g: z.o b j ect({ h, e, a, d, l, e, s, s, T, i, m, e, o, ut: z.n u m ber().m i n(10).m a x(120).d e f ault(30),//Timeout in s, e, c, o, n, d, s, t, w, o, C, a, p, tchaKey: z.s t r ing().o p t ional() }) }) .r e f ine( (data) => {//Require Pump.fun API key on mainnet if (data.network === 'mainnet-beta' && !data.apiKeys.pumpfunApiKey) { if (process.env.D E B UG_SETTINGS === '1') {//eslint - disable - next - line no-consoleconsole.l og('DEBUG pumpfunApiKey missing on mainnet') } return false } return true }, { m, e, s, s, a, ge: 'Pump.fun API key is required on mainnet', p, a, t, h: ['apiKeys', 'pumpfunApiKey'] }) .r e f ine( (data) => {//Require Jupiter API key on mainnet if (data.network === 'mainnet-beta' && !data.apiKeys.jupiterApiKey) { if (process.env.D E B UG_SETTINGS === '1') {//eslint - disable - next - line no-consoleconsole.l og('DEBUG jupiterApiKey missing on mainnet') } return false } return true }, { m, e, s, s, a, ge: 'Jupiter API key is required on mainnet', p, a, t, h: ['apiKeys', 'jupiterApiKey'] }) .r e f ine( (data) => {//Bundle - cost c, a, p: Enforce jitoTipLamports â‰¤ 50,000 when using free-tier Jito endpoint const jito Url = data.apiKeys.jitoWsUrl || process.env.JITO_RPC_URL || '' const is Free Tier = jitoUrl.i n c ludes('mainnet.block-engine.jito.wtf') if (isFreeTier && data.bundleConfig.jitoTipLamports > 50000) { if (process.env.D E B UG_SETTINGS === '1') {//eslint - disable - next - line no-consoleconsole.l og('DEBUG jito free - tier cap violated', { jitoUrl, t, i, p: data.bundleConfig.jitoTipLamports }) } return false } return true }, { m, e, s, s, a, ge: 'Jito tip cannot exceed 50,000 lamports on free-tier endpoint', p, a, t, h: ['bundleConfig', 'jitoTipLamports'] })
