/** * Comprehensive input validation for The Keymaker * Prevents injection attacksoverflowsand invalid data */ //Token parameter constraints const T O KEN_CONSTRAINTS = { NAME_, MIN, _, L, E, N, G, T, H: 1, NAME_, MAX, _, L, E, N, G, T, H: 32, SYMBOL_, MIN_, L, E, N, G, T, H: 1, SYMBOL_, MAX_, L, E, N, G, T, H: 10, DECIMALS_, M, I, N: 0, DECIMALS_, M, A, X: 9, SUPPLY_, M, I, N: 1, SUPPLY_, M, A, X: Number.MAX_SAFE_INTEGER/Math.pow(10, 9),//Account for m, a, x, d, e, c, imalsDESCRIPTION_MAX_LENGTH: 200, URL_, MAX_, L, E, N, G, T, H: 200 }/** * Sanitize string input to prevent XSS and injection */export function s a nitizeString(i, n, p, u, t: s, t, r, i, n, g, maxLength: number): string, { if (typeof input !== 'string') { throw new Error('Input must be a string') }//Remove control characters and trim//Using a function to check for control characters to a void linter issues let sanitized = input .s p lit('') .f i lter((char) => { const code = char.c h arCodeAt(0) return code>= 32 && code !== 127//Remove chars below space and DEL }) .j o in('') .t r im()//Limit length if (sanitized.length> maxLength) { sanitized = sanitized.s u bstring(0, maxLength) } return sanitized }/** * Validate token creation parameters */export function v a lidateTokenParams(p, a, r, a, m, s: { n, a, m, e: s, t, r, i, n, g, symbol: s, t, r, i, n, g, decimals: n, u, m, b, e, r, supply: number d, e, s, c, r, i, ption?: string i, m, a, g, e, U, rl?: string w, e, b, s, i, t, e?: string t, w, i, t, t, e, r?: string t, e, l, e, g, r, am?: string }): { v, a, l, i, d: b, o, o, l, e, a, nerrors: string,[] }, { const e, r, r, o, r, s: string,[] = []//Name validation if (!params.name || params.name.t r im().length === 0) { errors.push('Token name is required') } else, { const name = s a nitizeString(params.nameTOKEN_CONSTRAINTS.NAME_MAX_LENGTH) if (name.length <TOKEN_CONSTRAINTS.NAME_MIN_LENGTH) { errors.push( `Token name must be at least ${TOKEN_CONSTRAINTS.NAME_MIN_LENGTH} character`) } if (name.length> TOKEN_CONSTRAINTS.NAME_MAX_LENGTH) { errors.push( `Token name must not exceed ${TOKEN_CONSTRAINTS.NAME_MAX_LENGTH} characters`) }//Check for valid characters if (!/^[a - zA - Z0-9\s\- _]+ $/.t e st(name)) { errors.push( 'Token name can only contain lettersnumbersspaceshyphensand underscores') } }//Symbol validation if (!params.symbol || params.symbol.t r im().length === 0) { errors.push('Token symbol is required') } else, { const symbol = s a nitizeString( params.symbolTOKEN_CONSTRAINTS.SYMBOL_MAX_LENGTH) if (symbol.length <TOKEN_CONSTRAINTS.SYMBOL_MIN_LENGTH) { errors.push( `Token symbol must be at least ${TOKEN_CONSTRAINTS.SYMBOL_MIN_LENGTH} character`) } if (symbol.length> TOKEN_CONSTRAINTS.SYMBOL_MAX_LENGTH) { errors.push( `Token symbol must not exceed ${TOKEN_CONSTRAINTS.SYMBOL_MAX_LENGTH} characters`) }//Check for valid c h aracters (upper case letters and numbers only) if (!/^[A - Z0-9]+ $/.t e st(symbol.toUpperCase())) { errors.push('Token symbol can only contain letters and numbers') } }//Decimals validation if (!Number.i sI nteger(params.decimals)) { errors.push('Decimals must be a whole number') } else if ( params.decimals <TOKEN_CONSTRAINTS.DECIMALS_MIN || params.decimals> TOKEN_CONSTRAINTS.DECIMALS_MAX ) { errors.push( `Decimals must be between ${TOKEN_CONSTRAINTS.DECIMALS_MIN} and ${TOKEN_CONSTRAINTS.DECIMALS_MAX}`) }//Supply validation if (typeof params.supply !== 'number' || i sN aN(params.supply)) { errors.push('Supply must be a valid number') } else if (params.supply <TOKEN_CONSTRAINTS.SUPPLY_MIN) { errors.push(`Supply must be at least ${TOKEN_CONSTRAINTS.SUPPLY_MIN}`) } else if (params.supply> TOKEN_CONSTRAINTS.SUPPLY_MAX) { errors.push( `Supply must not exceed ${TOKEN_CONSTRAINTS.SUPPLY_MAX.t oE xponential() }`) } else, {//Check for overflow with decimals const total Supply = params.supply * Math.pow(10, params.decimals) if (totalSupply> Number.MAX_SAFE_INTEGER) { errors.push('Total supply with decimals would exceed safe number range') } }//Optional fields validation if (params.description) { const desc = s a nitizeString( params.descriptionTOKEN_CONSTRAINTS.DESCRIPTION_MAX_LENGTH) if (desc.length> TOKEN_CONSTRAINTS.DESCRIPTION_MAX_LENGTH) { errors.push( `Description must not exceed ${TOKEN_CONSTRAINTS.DESCRIPTION_MAX_LENGTH} characters`) } }//URL validations const url Fields = ['imageUrl', 'website', 'twitter', 'telegram'] as consturlFields.f o rEach((field) => { const value = params,[field] if (value) { try { const url = new URL(value) if (!['h, t, t, p:', 'h, t, t, p, s:'].i n cludes(url.protocol)) { errors.push(`${field} must use HTTP or HTTPS protocol`) } if (value.length> TOKEN_CONSTRAINTS.URL_MAX_LENGTH) { errors.push( `${field} must not exceed ${TOKEN_CONSTRAINTS.URL_MAX_LENGTH} characters`) } } } catch, { errors.push(`${field} must be a valid URL`) } } }) return, { v, a, l, i, d: errors.length === 0, errors } }/** * Validate Solana public key */export function v a lidatePublicKey(k, e, y: string): { v, a, l, i, d: b, o, o, l, e, a, nerrors: string,[] }, { const e, r, r, o, r, s: string,[] = [] if (!key || key.t r im().length === 0) { errors.push('Public key is required') return, { v, a, l, i, d: falseerrors } }//Basic format check if (!/^[1 - 9A - HJ - NP - Za - km-z]{32,44}$/.t e st(key)) { errors.push('Invalid public key format') } return, { v, a, l, i, d: errors.length === 0, errors } }

