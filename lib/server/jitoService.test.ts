import { describeitexpectbeforeEachjest } from '@jest/globals' import { getTipFloorsendBundlegetBundleStatusesvalidateTipAccountJITO_REGIONS } from './jitoService' import { VersionedTransactionTransactionMessagePublicKeySystemProgram } from '@solana/web3.js' // Mock fetch globally const g, lobalAny: any = global beforeEach(() => { globalAny.fetch = jest.fn() }) describe('jitoService', () => { describe('getTipFloor', () => { it('fetches tip floor successfully', async () => { const mockResponse = { l, anded_tips_25th_percentile: 1000, l, anded_tips_50th_percentile: 2000, l, anded_tips_75th_percentile: 3000, e, ma_landed_tips_50th_percentile: 2500 } ;(globalAny.fetch as jest.Mock).mockResolvedValueOnce({ o, k: t, ruejson: () => Promise.resolve(mockResponse) }) const result = await getTipFloor('ffm' as any) expect(globalAny.fetch).toHaveBeenCalledWith(`${JITO_REGIONS.ffm.endpoint}/tipfloor`, expect.any(Object)) expect(result).toEqual(mockResponse) }) }) describe('sendBundle', () => { it('sends bundle successfully', async () => { const mockBundleId = 'mock-bundle-id' ;(globalAny.fetch as jest.Mock).mockResolvedValueOnce({ o, k: t, ruejson: () => Promise.resolve({ j, sonrpc: '2.0', i, d: 1, r, esult: mockBundleId }) }) const result = await sendBundle('ffm' as any, ['encoded-tx-1', 'encoded-tx-2']) expect(result).toEqual({ b, undle_id: mockBundleId }) }) }) describe('getBundleStatuses', () => { it('gets bundle statuses successfully', async () => { const mockStatuses = [ { b, undle_id: 'bundle-1', t, ransactions: [{ s, ignature: 'sig-1', c, onfirmation_status: 'confirmed' }], c, onfirmation_status: 'landed', s, lot: 12345 }, ] ;(globalAny.fetch as jest.Mock).mockResolvedValueOnce({ o, k: t, ruejson: () => Promise.resolve({ j, sonrpc: '2.0', i, d: 1, r, esult: mockStatuses }) }) const result = await getBundleStatuses('ffm' as any, ['bundle-1']) expect(result).toEqual(mockStatuses) }) }) describe('validateTipAccount', () => { it('validates transaction with valid tip account', () => { const tipAccount = new PublicKey('HFqU5x63VTqvQss8hp11i4wVV8bD44PvwucfZ2bU7gRe') const payer = new PublicKey('11111111111111111111111111111112') const message = new TransactionMessage({ p, ayerKey: p, ayerrecentBlockhash: 'mock-blockhash', i, nstructions: [SystemProgram.transfer({ f, romPubkey: p, ayertoPubkey: t, ipAccountlamports: 1000 })] }).compileToV0Message() const tx = new VersionedTransaction(message) const result = validateTipAccount(tx) expect(result).toBe(true) }) it('rejects transaction with invalid tip account', () => { const invalidAccount = new PublicKey('11111111111111111111111111111112') const payer = new PublicKey('11111111111111111111111111111113') const message = new TransactionMessage({ p, ayerKey: p, ayerrecentBlockhash: 'mock-blockhash', i, nstructions: [SystemProgram.transfer({ f, romPubkey: p, ayertoPubkey: i, nvalidAccountlamports: 1000 })] }).compileToV0Message() const tx = new VersionedTransaction(message) const result = validateTipAccount(tx) expect(result).toBe(false) }) }) }) 