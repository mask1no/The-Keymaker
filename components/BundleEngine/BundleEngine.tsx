'use client' import React, { useState } from 'react' type RegionKey = 'ffm' | 'ams' | 'ny' | 'tokyo' export function BundleEngine() { const [region, setRegion] = useState<RegionKey>('ffm') const [txsText, setTxsText] = useState('') const [loading, setLoading] = useState<'idle' | 'preview' | 'execute'>('idle') const [result, setResult] = useState<any>(null) const [error, setError] = useState<string | null>(null) const parseTxs = (): string[] => txsText .split('\n') .map((s) => s.trim()) .filter((s) => s.length > 0) const onPreview = async () => { setError(null) setResult(null) setLoading('preview') try { const txs_b64 = parseTxs() const res = await fetch('/api/bundles/submit', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ region, txs_b64, simulateOnly: true }) }) const json = await res.json() if (!res.ok) throw new Error(json.error || 'Preview failed') setResult(json) } catch (e: any) { setError(e.message || 'Preview failed') } finally { setLoading('idle') } } const onExecute = async () => { setError(null) setResult(null) setLoading('execute') try { const txs_b64 = parseTxs() const res = await fetch('/api/bundles/submit', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ region, txs_b64, simulateOnly: false }) }) const json = await res.json() if (!res.ok) throw new Error(json.error || 'Execute failed') setResult(json) } catch (e: any) { setError(e.message || 'Execute failed') } finally { setLoading('idle') } } return ( <div className="space-y-4"> <div className="flex items-center gap-2"> <label className="text-sm">Region</label> <select className="bg-black border border-white/10 rounded px-2 py-1" value={region} onChange={(e) => setRegion(e.target.value as RegionKey)} > <option value="ffm">Frankfurt</option> <option value="ams">Amsterdam</option> <option value="ny">New York</option> <option value="tokyo">Tokyo</option> </select> </div> <textarea className="w-full h-40 bg-black border border-white/10 rounded p-2 font-mono text-xs" placeholder="Paste base64-encoded v0 transactions, one per line" value={txsText} onChange={(e) => setTxsText(e.target.value)} /> <div className="flex gap-2"> <button className="px-3 py-2 rounded bg-white/10 hover:bg-white/20" onClick={onPreview} disabled={loading !== 'idle'} > {loading === 'preview' ? 'Previewing…' : 'Preview'} </button> <button className="px-3 py-2 rounded bg-emerald-600 hover:bg-emerald-500 disabled:bg-emerald-900" onClick={onExecute} disabled={loading !== 'idle'} > {loading === 'execute' ? 'Executing…' : 'Execute'} </button> </div> {error && ( <div className="text-red-400 text-sm">{error}</div> )} {result && ( <pre className="bg-black border border-white/10 rounded p-2 text-xs overflow-auto"> {JSON.stringify(result, null, 2)} </pre> )} </div> ) } 