services:
  keymaker:
    environment:
      # Core Configuration
      NODE_ENV: production

      # Public RPC endpoint (do not compose from secret keys here)
      NEXT_PUBLIC_HELIUS_RPC: https://api.mainnet-beta.solana.com
      NEXT_PUBLIC_JITO_ENDPOINT: https://mainnet.block-engine.jito.wtf
      # Server RPC can be a secret-backed URL; prefer configuring via .env
      RPC_URL: ${RPC_URL}

      # Server-only secrets (configure via .env; do not commit real values)
      BIRDEYE_API_KEY: ${BIRDEYE_API_KEY}

      # Pump.fun API (server-only)
      PUMPFUN_API_KEY: ${PUMPFUN_API_KEY}

      # Optional services (add keys when you have them)
      MOONSHOT_API_KEY: ${MOONSHOT_API_KEY}
      JITO_AUTH_TOKEN: ${JITO_AUTH_TOKEN}
      HELIUS_API_KEY: ${HELIUS_API_KEY}
      KEYPAIR: ${KEYPAIR}
      SENTRY_DSN: ${SENTRY_DSN}
      # Do not expose Sentry DSN to client by default

    # Security measures
    security_opt:
      - no-new-privileges:true

    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 2G

    # Better logging configuration
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'
        max-file: '5'
        compress: 'true'
        labels: 'service=keymaker,env=production'
