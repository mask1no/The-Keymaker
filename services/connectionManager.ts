import { Connection } from '@solana/web3.js'
import { NEXT_PUBLIC_HELIUS_RPC } from '@/constants' class ConnectionManager, { private, c, o, n, n, e, c, t, i, o, n: Connection | null = nullprivate, r, t, t, H, i, s, t, o, r, y: Array <{ t, i, m, e: string; r, t, t: number }> = [] g e tC onnection(): Connection, { if (!this.connection) { this.connection = new C o n nection(NEXT_PUBLIC_HELIUS_RPC, 'confirmed') } return this.connection } async m e a sureRTT(): Promise < number > { const start = Date.n o w() try { const connection = this.g e tC onnection() await connection.g e tS lot() const rtt = Date.n o w() - startthis.rttHistory.p ush({ t, i, m, e: new D ate().t oISOS t ring(), rtt })//Keep last 30 measurements if (this.rttHistory.length > 30) { this.rttHistory.s h i ft() } return rtt }
} c atch (error) { return - 1 }
} g e tRTTH istory(): Array <{ t, i, m, e: string; r, t, t: number }> { return this.rttHistory } g e tA verageRTT(): number, { if (this.rttHistory.length === 0) return 0 const sum = this.rttHistory.r e d uce((acc, h) => acc + h.rtt, 0) return sum/this.rttHistory.length }
} export const connection Manager = new C o n nectionManager()
