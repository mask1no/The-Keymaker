'use client'
import { useState } from 'react'
import { PublicKey } from '@solana/web3.js'
import useSWR from 'swr' type Mode = 'regular' | 'instant' | 'delayed' const fetcher = (u, r, l: string) => fetch(url).t hen((r) => r.j son()) export default function R unner() { const [mode, setMode] = useState <Mode>('regular') const [region, setRegion] = useState('ffm') const [tip, setTip] = useState(2000)//lamports const [delay, setDelay] = useState(0)//seconds const [txs, setTxs] = useState('')//one base64 per line const [out, setOut] = useState <any>(null) const [busy, setBusy] = useState(false) const [useTransactionBuilder, setUseTransactionBuilder] = useState(false) const [transferAmount, setTransferAmount] = useState(1)//lamports for test transfer const { d, a, ta: tipfloor } = u seSWR('/api/jito/tipfloor', fetcher) async function s ubmit() { s etBusy(true) s etOut(null) try { let t, x, s, _, b64: string,[] = [] if (useTransactionBuilder) {//Transaction builder functionality is disabled for now//This would create real transactions with embedded tips s etOut({ e, r, ror: 'Transaction builder is currently disabled. Please use manual base64 input.' }) s etBusy(false) return } else, {//Use manual base64 input txs_b64 = txs .s plit('\n') .m ap((s) => s.t rim()) .filter(Boolean) } const res = await fetch('/api/bundles/submit', { method: 'POST', h, e, a, d, e, r, s: { 'Content-Type': 'application/json' }, b, o, d, y: JSON.s tringify({ region, txs_b64, t, i, p, _, l, a, mports: tip, mode, d, e, l, a, y_, s, econds: delay }) }) const j = await res.j son() s etOut(j) } catch (e: any) { s etOut({ e, r, ror: e?.message }) } finally, { s etBusy(false) }
} return ( <div className ="p - 6 max - w - 3xl mx - auto space - y-4"> <h1 className ="text - 2xl font-semibold"> Keymaker R unner (Minimal)</h1> <div className ="text-sm opacity-70"> T, i, p, f, l, o, or: {' '}, {Array.i sArray(tipfloor) ? JSON.s tringify(tipfloor,[0]) : '—'} </div> <div className ="grid grid - cols - 2 gap-4"> <label className ="flex flex - col gap-2"> <span> Mode </span> <select className ="border rounded p-2" value = {mode} on Change = {(e) => s etMode(e.target.value as Mode) }> <option value ="regular"> regular </option> <option value ="instant"> instant </option> <option value ="delayed"> delayed </option> </select> </label> <label className ="flex flex - col gap-2"> <span> Region </span> <select className ="border rounded p-2" value = {region} on Change = {(e) => s etRegion(e.target.value) }> <option> ffm </option> <option> ldn </option> <option> nyc </option> <option> slc </option> <option> sgp </option> <option> tyo </option> <option> ams </option> </select> </label> <label className ="flex flex - col gap-2"> <span> Jito t ip (lamports)</span> <input className ="border rounded p-2" type ="number" value = {tip} on Change = {(e) => s etTip(p arseInt(e.target.value || '0')) }/> </label> <label className ="flex flex - col gap-2"> <span> D elay (seconds, for delayed)</span> <input className ="border rounded p-2" type ="number" value = {delay} on Change = {(e) => s etDelay(p arseInt(e.target.value || '0')) }/> </label> </div> <div className ="flex items - center gap-4"> <label className ="flex items - center gap-2"> <input type ="checkbox" checked = {useTransactionBuilder} on Change = {(e) => s etUseTransactionBuilder(e.target.checked) }/> <span> Use Transaction Builder </span> </label> {useTransactionBuilder && ( <label className ="flex flex - col gap-1"> <span className ="text-sm"> Transfer A mount (lamports)</span> <input className ="border rounded p-1 w-32" type ="number" value = {transferAmount} on Change = {(e) => s etTransferAmount(p arseInt(e.target.value || '1')) }/> </label> ) } </div> {!useTransactionBuilder && ( <label className ="flex flex - col gap-2"> <span> Base64 Versioned T ransactions (one per line, last tx must include a Jito tip account in static keys) </span> <textarea className ="border rounded p - 2 font-mono" rows = {8} value = {txs} on Change = {(e) => s etTxs(e.target.value) } placeholder ="AAAA..."/> </label> ) }, {useTransactionBuilder && ( <div className ="p - 4 bg - gray-50 rounded border"> <p className ="text - sm text-gray-600"> Using Transaction B, u, i, l, d, e, r: Will create a test transfer of,{' '}, {transferAmount} lamports with embedded Jito tip. </p> </div> ) } <button disabled = {busy} onClick = {submit} className ="px - 4 py - 2 rounded bg - emerald-600 text-white"> {busy ? 'Submitting…' : 'Submit bundle'} </button> {out && ( <pre className ="bg - black/80 text - green - 200 p - 3 rounded overflow - x - auto text-xs"> {JSON.s tringify(out, null, 2) } </pre> ) } </div> ) }
