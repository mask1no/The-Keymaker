# The Keymaker - Solana Memecoin Bundler Rules

## Core Principles
- Use Python 3.10+, TypeScript with strict types
- All backend logic in services/ or bonk-mcp/
- All UI components in components/
- Must use async/await in Python and TypeScript
- No mock data, no dummy states, no placeholders
- Every button = real transaction or error
- Encrypt wallet keys using AES-256
- Console logs mirrored to logs database
- Testable in 1 session

## Code Standards

### TypeScript/JavaScript
- Strict TypeScript mode always
- Explicit return types for all functions
- No `any` types without justification
- Use Zod for runtime validation
- Proper error boundaries in React components
- Use React.memo for performance-critical components

### Python
- Type hints required for all functions
- Use asyncio for all I/O operations
- Proper exception handling with specific exceptions
- Use dataclasses or Pydantic for data models
- No bare `except:` clauses

### Solana Specific
- Always validate PublicKeys before use
- Handle transaction confirmation properly
- Use appropriate commitment levels (confirmed/finalized)
- Implement retry logic with exponential backoff
- Always check wallet balances before operations
- Use Jito bundles for MEV protection

## Architecture Rules

### Frontend (Next.js)
- Server components by default
- Client components only when needed (useState, onClick, etc)
- Use Zustand for global state
- No prop drilling beyond 2 levels
- All API calls through lib/apiClient.ts
- Tailwind for styling, no inline styles

### Backend Services
- Each service = single responsibility
- All Solana operations must be atomic
- Log every transaction with slot number
- Services return typed results or throw
- No silent failures

### Security
- Private keys encrypted with AES-256-GCM
- Keys stored in memory or sessionStorage only
- Clear keys on logout/disconnect
- Validate all user inputs
- Sanitize logs to prevent key leakage
- No private keys in console.logs

## UI/UX Rules
- Dark mode only (bg-gray-900 base)
- Glassmorphism effects with backdrop-blur
- All buttons show loading state
- Toast notifications for all actions
- Framer Motion for meaningful animations
- Mobile responsive, not mobile-first
- Compact grid layouts

## Transaction Rules
- Every transaction must be logged
- Include: phase, wallet, slot, status, timestamp, txId
- Failed transactions must show reason
- Retry failed transactions up to 3 times
- Bundle transactions when possible
- Always estimate and show fees upfront

## Testing Requirements
- Test with real SOL on devnet first
- Validate all token operations
- Test bundle execution with multiple wallets
- Ensure sells execute properly
- Check PnL calculations
- Verify encryption/decryption

## Performance
- Batch RPC calls when possible
- Use Promise.all for parallel operations
- Implement proper caching
- Lazy load heavy components
- Optimize bundle sizes
- Monitor TPS during execution

## Error Handling
- User-friendly error messages
- Technical details in logs only
- Retry transient failures automatically
- Show actionable error solutions
- Never crash the UI
- Graceful degradation

## Git Commit Rules
- Conventional commits (feat:, fix:, chore:, etc)
- Reference issue numbers
- Atomic commits
- No commented code in commits
- Update tests with features

## Documentation
- JSDoc for all public functions
- README must be comprehensive
- Include architecture diagrams
- Document all ENV variables
- Provide example .env file
- Keep CHANGELOG updated 