import { safeToBigIntLE, safeToBufferLE, sanitizeNumericInput, SafeMath } from './safeBigInt'; describe('SafeBigInt Utils', () => { describe('safeToBigIntLE', () => { it('should convert positive numbers correctly', () => { const result = safeToBigIntLE(42); expect(result).toBe(42n); }); it('should convert zero correctly', () => { const result = safeToBigIntLE(0); expect(result).toBe(0n); }); it('should handle large numbers', () => { const result = safeToBigIntLE(1000000000000); expect(result).toBe(1000000000000n); }); it('should handle decimal truncation', () => { const result = safeToBigIntLE(42.99); expect(result).toBe(42n); }); it('should handle negative numbers', () => { const result = safeToBigIntLE(-42); expect(result).toBe(-42n); }); it('should handle string input', () => { const result = safeToBigIntLE('123'); expect(result).toBe(123n); }); it('should handle invalid input gracefully', () => { const result = safeToBigIntLE('invalid' as any); expect(result).toBe(0n); }); }); describe('safeToBufferLE', () => { it('should convert positive number to buffer', () => { const result = safeToBufferLE(42, 8); expect(result).toBeInstanceOf(Buffer); expect(result.length).toBe(8); }); it('should handle zero', () => { const result = safeToBufferLE(0, 4); expect(result).toBeInstanceOf(Buffer); expect(result.length).toBe(4); expect(result.every((byte) => byte === 0)).toBe(true); }); it('should handle invalid input gracefully', () => { const result = safeToBufferLE('invalid' as any, 8); expect(result).toBeInstanceOf(Buffer); expect(result.length).toBe(8); }); }); describe('sanitizeNumericInput', () => { it('should sanitize valid numeric string', () => { const result = sanitizeNumericInput('123.45'); expect(result).toBe('123.45'); }); it('should remove invalid characters', () => { const result = sanitizeNumericInput('1a2b3.4c5'); expect(result).toBe('123.45'); }); it('should handle negative numbers', () => { const result = sanitizeNumericInput('-123.45'); expect(result).toBe('-123.45'); }); it('should handle empty string', () => { const result = sanitizeNumericInput(''); expect(result).toBe(''); }); it('should handle only invalid characters', () => { const result = sanitizeNumericInput('abc'); expect(result).toBe(''); }); it('should handle multiple decimal points', () => { const result = sanitizeNumericInput('12.34.56'); expect(result).toBe('12.3456'); }); }); describe('SafeMath', () => { describe('add', () => { it('should add positive numbers', () => { const result = SafeMath.add(5, 3); expect(result).toBe(8n); }); it('should handle zero addition', () => { const result = SafeMath.add(5, 0); expect(result).toBe(5n); }); it('should handle negative addition', () => { const result = SafeMath.add(5, -3); expect(result).toBe(2n); }); }); describe('subtract', () => { it('should subtract positive numbers', () => { const result = SafeMath.subtract(10, 3); expect(result).toBe(7n); }); it('should handle zero subtraction', () => { const result = SafeMath.subtract(5, 0); expect(result).toBe(5n); }); it('should handle negative results', () => { const result = SafeMath.subtract(3, 5); expect(result).toBe(-2n); }); }); describe('multiply', () => { it('should multiply positive numbers', () => { const result = SafeMath.multiply(5, 3); expect(result).toBe(15n); }); it('should handle zero multiplication', () => { const result = SafeMath.multiply(5, 0); expect(result).toBe(0n); }); it('should handle negative multiplication', () => { const result = SafeMath.multiply(-5, 3); expect(result).toBe(-15n); }); }); describe('divide', () => { it('should divide positive numbers', () => { const result = SafeMath.divide(15, 3); expect(result).toBe(5n); }); it('should handle division with remainder', () => { const result = SafeMath.divide(16, 3); expect(result).toBe(5n); }); it('should throw on division by zero', () => { expect(() => SafeMath.divide(5, 0)).toThrow('Division by zero'); }); it('should handle negative division', () => { const result = SafeMath.divide(-15, 3); expect(result).toBe(-5n); }); }); describe('percentage', () => { it('should calculate percentage correctly', () => { const result = SafeMath.percentage(200, 50); expect(result).toBe(100n); }); it('should handle zero amount', () => { const result = SafeMath.percentage(0, 50); expect(result).toBe(0n); }); it('should handle zero percentage', () => { const result = SafeMath.percentage(100, 0); expect(result).toBe(0n); }); }); });
});
